# Guide de D√©ploiement Complet pour WorkHub Central

F√©licitations pour avoir termin√© votre projet ! Ce document vous guide pas √† pas pour prendre le projet que vous avez export√©, le configurer sur votre ordinateur, le publier sur GitHub, et le d√©ployer en production avec Vercel et Supabase.

---

## √âtape 1 : Obtenir vos Cl√©s d'API (Supabase & Cloudinary)

Avant de pouvoir lancer le projet, vous avez besoin de cl√©s secr√®tes pour connecter l'application √† ses services externes.

### A. Base de Donn√©es avec Supabase

Supabase sera notre source de v√©rit√© pour toutes les donn√©es (postes, standards, formulaires).

1.  **Cr√©ez votre projet Supabase :**
    *   Rendez-vous sur [supabase.com](https://supabase.com) et cr√©ez un compte (celui de GitHub est parfait).
    *   Cr√©ez une **Nouvelle Organisation**, puis un **Nouveau Projet**.
    *   Donnez-lui un nom clair (ex: `workhub-central-prod`).
    *   **G√©n√©rez un mot de passe de base de donn√©es** et **conservez-le pr√©cieusement**. C'est une cl√© ma√Ætresse.
    *   Choisissez la r√©gion du serveur la plus proche de vos utilisateurs.

2.  **Ex√©cutez le script SQL pour cr√©er les tables :**
    *   Une fois votre projet pr√™t, allez dans l'**√âditeur SQL** (ic√¥ne de table de base de donn√©es).
    *   Cliquez sur **"+ New query"**.
    *   Copiez-collez l'int√©gralit√© du script ci-dessous et cliquez sur **"RUN"**.

    ```sql
    -- Cr√©ation de la table pour les Postes de Travail (Workstations)
    create table public.workstations (
      id uuid primary key default gen_random_uuid(),
      name text not null,
      type text not null,
      description text,
      image text,
      files jsonb,
      created_at timestamp with time zone default timezone('utc'::text, now()) not null
    );

    -- Cr√©ation de la table pour les Standards
    create table public.standards (
      id uuid primary key default gen_random_uuid(),
      name text not null,
      category text not null,
      version text,
      description text,
      image text,
      files jsonb,
      last_updated timestamp with time zone default timezone('utc'::text, now()) not null
    );

    -- Cr√©ation de la table pour les Formulaires (Forms)
    create table public.forms (
      id uuid primary key default gen_random_uuid(),
      name text not null,
      table_data jsonb,
      files jsonb,
      last_updated timestamp with time zone default timezone('utc'::text, now()) not null,
      reference text,
      edition text,
      issue_date date,
      page_count integer
    );
    
    -- Cr√©ation de la table pour les √©v√©nements d'analyse (Analytics)
    create table public.analytics_events (
      id bigint generated by default as identity primary key,
      created_at timestamp with time zone default timezone('utc'::text, now()) not null,
      event_type text not null,
      target_type text not null,
      target_id text not null,
      target_details jsonb
    );

    -- Activer la s√©curit√© au niveau des lignes (RLS) - √âtape CRUCIALE
    alter table public.workstations enable row level security;
    alter table public.standards enable row level security;
    alter table public.forms enable row level security;
    alter table public.analytics_events enable row level security;

    -- Cr√©er des politiques d'acc√®s public en lecture seule
    create policy "Public workstations are viewable by everyone." on public.workstations for select using (true);
    create policy "Public standards are viewable by everyone." on public.standards for select using (true);
    create policy "Public forms are viewable by everyone." on public.forms for select using (true);

    -- Cr√©er des politiques autorisant l'√©criture (pour le prototype)
    create policy "Anyone can manage workstations." on public.workstations for all with check (true);
    create policy "Anyone can manage standards." on public.standards for all with check (true);
    create policy "Anyone can manage forms." on public.forms for all with check (true);
    create policy "Anyone can insert analytics events." on public.analytics_events for insert with check (true);
    create policy "Anyone can read analytics events." on public.analytics_events for select using (true);

    ```
    
    > **MISE √Ä JOUR IMPORTANTE :** Si vous avez d√©j√† cr√©√© la table `forms` et que vous devez simplement ajouter les nouvelles colonnes, ex√©cutez la commande suivante √† la place :
    > ```sql
    > alter table public.forms
    > add column if not exists reference text,
    > add column if not exists edition text,
    > add column if not exists issue_date date,
    > add column if not exists page_count integer;
    > ```

3.  **R√©cup√©rez vos cl√©s Supabase :**
    *   Dans **Project Settings** (ic√¥ne d'engrenage) > **API**.
    *   Conservez la **Project URL**.
    *   Conservez la cl√© `anon` `public` (jamais la cl√© `service_role` secr√®te).

### B. Stockage de Fichiers avec Cloudinary

Cloudinary g√®re le t√©l√©versement des images et des fichiers.

1.  **Cr√©ez un compte Cloudinary :** Allez sur [cloudinary.com](https://cloudinary.com) et inscrivez-vous. Le plan gratuit est largement suffisant.
2.  **R√©cup√©rez votre "Cloud Name" :** Il est visible en haut de votre tableau de bord.
3.  **Cr√©ez un "Upload Preset" :**
    *   Allez dans **Settings** (ic√¥ne d'engrenage) > **Upload**.
    *   Faites d√©filer jusqu'√† **Upload presets** et cliquez sur **"Add upload preset"**.
    *   Changez le **Signing Mode** de `Signed` √† `Unsigned`. C'est plus simple pour notre cas d'usage.
    *   Donnez-lui un nom m√©morable (ex: `workhub-preset`).
    *   Sauvegardez et **copiez le nom du preset**.

---

## √âtape 2 : Configuration de votre Environnement Local

Une fois le projet t√©l√©charg√© et d√©compress√© sur votre ordinateur :

1.  **Ouvrez un terminal** √† la racine du projet.
2.  **Installez les d√©pendances** en ex√©cutant la commande :
    ```bash
    npm install
    ```
3.  **Cr√©ez le fichier d'environnement :**
    *   √Ä la racine du projet, cr√©ez un fichier nomm√© exactement `.env.local`.
    *   Ce fichier est crucial : il contient vos cl√©s secr√®tes et **ne doit JAMAIS √™tre partag√© ou mis sur GitHub**.
    *   Copiez-collez le mod√®le ci-dessous dans ce fichier et remplacez les valeurs par VOS cl√©s obtenues √† l'√©tape 1.

    ```
    # Cl√©s Supabase
    NEXT_PUBLIC_SUPABASE_URL=VOTRE_PROJECT_URL_DE_SUPABASE_ICI
    NEXT_PUBLIC_SUPABASE_ANON_KEY=VOTRE_ANON_KEY_DE_SUPABASE_ICI

    # Cl√©s Cloudinary
    NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME=VOTRE_CLOUD_NAME_DE_CLOUDINARY
    NEXT_PUBLIC_CLOUDINARY_UPLOAD_PRESET=VOTRE_UPLOAD_PRESET_DE_CLOUDINARY
    ```
4.  **Lancez le serveur de d√©veloppement :**
    ```bash
    npm run dev
    ```
    Ouvrez votre navigateur √† l'adresse [http://localhost:9003](http://localhost:9003). L'application devrait fonctionner !

> üö® **Que faire si j'obtiens une erreur "Cl√©s manquantes" ?**
> C'est presque toujours un probl√®me avec le fichier `.env.local`. V√©rifiez :
> *   Le nom du fichier est-il bien `.env.local` (avec le point) ?
> *   Est-il √† la racine du projet (au m√™me niveau que `package.json`) ?
> *   Avez-vous bien remplac√© les valeurs d'exemple par vos vraies cl√©s ?
> *   Avez-vous red√©marr√© le serveur (`CTRL+C` puis `npm run dev`) apr√®s avoir modifi√© le fichier ?

---

## √âtape 3 : Mettre votre Code sur GitHub

Pour que Vercel puisse d√©ployer votre site, le code doit √™tre sur GitHub.

### A. Cr√©er le d√©p√¥t sur GitHub.com

1.  Sur [github.com](https://github.com), cliquez sur **"New repository"**.
2.  Donnez-lui un nom (ex: `workhub-central-app`).
3.  Laissez-le **Public**.
4.  **Ne cochez AUCUNE case** ("Add a README file", etc.). Votre projet a d√©j√† tout ce qu'il faut.
5.  Cliquez sur **"Create repository"**.

### B. Envoyer le code (M√©thode recommand√©e : t√©l√©versement web)

C'est la m√©thode la plus simple et la plus fiable.

1.  Sur la page de votre d√©p√¥t GitHub vide, cliquez sur le lien **`uploading an existing file`**.
2.  Ouvrez le dossier de votre projet sur votre ordinateur.
3.  S√©lectionnez **tous les fichiers et dossiers** SAUF :
    *   le dossier `node_modules` (tr√®s lourd et inutile)
    *   le dossier `.next` (fichiers de build temporaires)
    *   le fichier `.env.local` (contient vos secrets !)
4.  **Glissez-d√©posez** les fichiers s√©lectionn√©s dans la fen√™tre de votre navigateur.
5.  Attendez que GitHub traite tous les fichiers.
6.  √âcrivez un message de commit (ex: `Initial project upload`) et cliquez sur **"Commit changes"**.

Et voil√† ! Votre code est sur GitHub, pr√™t √† √™tre d√©ploy√©.

---

## √âtape 4 : D√©ployer sur Vercel

1.  **Cr√©ez un compte Vercel :** Allez sur [vercel.com](https://vercel.com) et inscrivez-vous avec votre compte GitHub.
2.  **Importez votre projet :**
    *   Depuis votre tableau de bord, cliquez sur **"Add New... > Project"**.
    *   Choisissez le d√©p√¥t GitHub que vous venez de cr√©er et cliquez sur **"Import"**.
    *   Vercel d√©tectera automatiquement que c'est un projet Next.js.
3.  **Configurez les variables d'environnement (√âtape la plus importante) :**
    *   D√©roulez la section **"Environment Variables"**.
    *   Ajoutez une par une les **quatre m√™mes cl√©s** que vous avez dans votre fichier `.env.local`.
        *   `NEXT_PUBLIC_SUPABASE_URL`
        *   `NEXT_PUBLIC_SUPABASE_ANON_KEY`
        *   `NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME`
        *   `NEXT_PUBLIC_CLOUDINARY_UPLOAD_PRESET`
    *   V√©rifiez bien que les noms et les valeurs sont corrects.
4.  **D√©ployez !** Cliquez sur **"Deploy"**.

Apr√®s quelques minutes, votre site sera en ligne, enti√®rement fonctionnel. D√©sormais, chaque fois que vous mettrez √† jour votre code et le pousserez sur GitHub, Vercel red√©ploiera automatiquement la nouvelle version. C'est magique !
